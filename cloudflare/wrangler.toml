name = "coding-agent-api"
main = "src/index.ts"
compatibility_date = "2024-11-01"
compatibility_flags = ["nodejs_compat"]

# Development environment (default)
[vars]
MODAL_API_URL = "https://dbellan1291--coding-agent-sandbox"
CONVEX_SITE_URL = "https://brilliant-meadowlark-939.convex.site"
ALLOWED_ORIGINS = "http://localhost:3000,http://localhost:5173"
DEV_MODE = "true"
# MODAL_API_SECRET is optional in dev - if not set, Modal allows requests

# Durable Objects binding
[[durable_objects.bindings]]
name = "SESSION_AGENT"
class_name = "SessionAgent"

# Migrations for Durable Object
[[migrations]]
tag = "v1"
new_classes = ["SessionAgent"]

# =============================================================================
# Production Environment
# Deploy with: wrangler deploy --env production
# =============================================================================
[env.production]
name = "coding-agent-api-production"

[env.production.vars]
# IMPORTANT: Update these URLs before production deployment
MODAL_API_URL = "https://YOUR_USERNAME--coding-agent-sandbox"
CONVEX_SITE_URL = "https://YOUR_PROJECT.convex.site"
ALLOWED_ORIGINS = "https://your-production-domain.com"
# DEV_MODE not set = logging disabled in production
# MODAL_API_SECRET should be set via wrangler secret put MODAL_API_SECRET

[[env.production.durable_objects.bindings]]
name = "SESSION_AGENT"
class_name = "SessionAgent"

[[env.production.migrations]]
tag = "v1"
new_classes = ["SessionAgent"]
